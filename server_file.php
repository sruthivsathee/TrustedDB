<?php
session_start();
//echo $data;
//$theData = file_get_contents($data);

	//session_start();
echo "seed block is :". $_SESSION['seedblock'];
//$data="http://localhost/TRUST_DB/sample.pdf";
//echo $data;
	$data=$_REQUEST['link'];
	$user=$_SESSION['user'];
	echo "USER IS: ". $user;
	$data=trim($data);
	$file_name=basename($data);
//echo "<br>$file_name<br>".$data;
	$theData = file_get_contents($data);
//echo $theData;
	$msg=$theData;
	$c=$msg;
	$mlen=strlen($msg);
/*
	include('db/connection2.php');
	$result = mysql_query("SELECT * FROM account") or die(mysql_error());  
	$row = mysql_fetch_array($result);
	$key=$row['seedblock'];	
*/

$key=$_SESSION['seedblock'];
	$klen=strlen($key);
	$dd ="";
	if($mlen!=$klen)
	{
		while($klen<$mlen)
		{
			$dd=$dd.stringMaker();	
			$klen=strlen($dd);
		}
	}
	$dd=$key.$dd;
	$newkey=substr("$dd",0,$mlen);
	$newlen=strlen($newkey);
	$key=$newkey;
	$x=$c^$newkey;
	$myFile = "SERVER_FOLDER/enc/$file_name";
	echo "<h2> File Encrypted Sucessfully :";
	echo " <a href='$myFile' target='_blank'>"."Click to view :</h2></a><br/>";
	echo $myFile ;
	echo "<a href='server_download2.php'><h2>Back To Home <<</a></h2>";
	
	$fh = fopen($myFile, 'w') or die("can't open file");
	$stringData = $x;
	fwrite($fh, $stringData);
	fclose($fh);

function stringMaker()
{
$data="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
return $data;
}
?>